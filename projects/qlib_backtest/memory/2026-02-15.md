# 2026-02-15 - Qlib 参数优化探索

## 任务
探索 qlib 是否有优化策略参数的方法或函数

## 探索过程

### 1. 初始搜索
- 搜索了 qlib 官方文档
- 发现 GitHub Issue #1458 关于 HTE (Hyperparameters Tuning Engine)

### 2. 源代码探索
发现 qlib 安装路径：`/home/mystryl/.local/lib/python3.12/site-packages/qlib/`

找到以下重要模块：
- **Tuner** (`contrib/tuner/`) - 超参数调优器，使用 hyperopt
- **Optimizer** (`contrib/strategy/optimizer/`) - 投资组合权重优化器
- **RL** (`rl/`) - 强化学习模块

### 3. Qlib Tuner 模块详解

**核心特性：**
- 使用 hyperopt 库
- 采用 TPE（Tree-structured Parzen Estimator）算法
- 支持优化模型参数、策略参数、数据标签参数
- 通过 subprocess 并行运行回测

**主要类：**
```python
class Tuner:
    - objective()  # 优化目标函数
    - setup_space()  # 设置搜索空间
    - tune()  # 执行优化

class QLibTuner(Tuner):
    # 针对 qlib 工作流的实现
```

**预定义搜索空间：**
- TopkAmountStrategySpace
- QLibDataLabelSpace

### 4. Qlib Optimizer 模块详解

**功能：**
- 不是用于优化策略参数
- 用于优化投资组合权重分配

**支持的方法：**
- GMV (Global Minimum Variance)
- MVO (Mean Variance Optimization)
- RP (Risk Parity)
- INV (Inverse Volatility)
- Enhanced Indexing

## 发现与结论

### Qlib 提供的参数优化方法

| 方法 | 适用场景 | 实现库 |
|-----|---------|--------|
| Tuner | 基于预测信号的策略 | hyperopt |
| Optimizer | 投资组合权重 | scipy/cvxpy |
| RL | 订单执行和策略学习 | 自定义 |

### 对于技术指标策略（如 SuperTrend）

**Qlib Tuner 不是最优选择，因为：**
1. 需要配置完整的 qlib 工作流
2. 通过 subprocess 运行，效率较低
3. 学习曲线较陡

**推荐使用：**
- **Optuna** - 贝叶斯优化，效率高，可视化好
- **Hyperopt** - 可以单独使用
- **网格搜索** - 简单直接

## 创建的文件

### 文档
1. **QLIB_OPTIMIZATION_GUIDE.md** - Qlib 参数优化完整指南
   - Tuner 模块详细介绍
   - Optimizer 模块使用说明
   - 实际应用建议和示例代码

2. **OPTIMIZATION_EXPLORATION_REPORT.md** - 探索报告
   - 探索过程记录
   - 发现总结
   - 推荐方案

### 代码
3. **optimize_supertrend_optuna.py** - Optuna 优化脚本
   - 使用贝叶斯优化
   - 支持多年度数据
   - 自动生成可视化图表

### 已有的优化脚本
- **optimize_enhanced_supertrend.py** - 网格搜索优化（7个参数）
- **optimize_enhanced_params.py** - 多频率参数优化

## 使用建议

### 对于 SuperTrend 策略
1. **快速探索：** 网格搜索
2. **精细优化：** Optuna
3. **多频率：** `optimize_enhanced_params.py`

### 对于基于预测信号的投资组合策略
1. **使用 Qlib Tuner** - 原生支持

### 对于投资组合权重优化
1. **使用 Qlib Optimizer** - 专门的权重优化工具

## 下一步行动

1. 尝试运行 Optuna 优化脚本
2. 比较网格搜索 vs 贝叶斯优化
3. 探索多目标优化

## 参考资料

- Qlib 官方文档：https://qlib.readthedocs.io/
- Optuna 文档：https://optuna.readthedocs.io/
- Hyperopt 文档：http://hyperopt.github.io/hyperopt/
