# V01: 原版Pine策略 - 实施计划

## 策略概述
- **版本**: V01
- **名称**: 原版Pine策略
- **创建日期**: 2025-02-18
- **目的**: 完全按照Pine源码逻辑实现的MSB+OB策略

## 实现目标
1. 复现TradingView上的Pine Script策略逻辑
2. 使用MSB（Market Structure Break）作为入场信号
3. 使用OB（Order Block）作为出场和止损参考
4. 验证Pine策略在A股市场的有效性

## 入场规则

### 多头入场
1. MSB看涨信号：价格突破最近的高点枢轴点
2. 动量Z-Score大于0.5
3. 前一根K线收盘价低于枢轴点，当前根收盘价高于枢轴点

### 空头入场
1. MSB看跌信号：价格突破最近的低点枢轴点
2. 动量Z-Score小于-0.5
3. 前一根K线收盘价高于枢轴点，当前根收盘价低于枢轴点

## 出场规则

### 止损规则
1. 使用ATR（14周期）计算止损距离
2. 多头止损：入场价 - 1.0倍ATR
3. 空头止损：入场价 + 1.0倍ATR

### 止盈规则（分层）
- **TP1**: 入场价 +/- 0.5倍ATR（部分平仓）
- **TP2**: 入场价 +/- 1.0倍ATR（部分平仓）
- **TP3**: 入场价 +/- 1.5倍ATR（全部平仓）

### OB出场
- 当OB被市场价格失效时，平仓当前仓位
- OB失效条件：价格穿越OB区域

## 风险管理
- **止损设置**: 1倍ATR
- **止盈设置**: 分层止盈（0.5/1.0/1.5倍ATR）
- **仓位管理**: 等权重分配

## 回测参数
- **数据周期**: 60分钟
- **回测期间**: 2023-2025年
- **交易品种**: RB9999（螺纹钢主力合约）

### 关键参数
| 参数 | 值 | 说明 |
|------|-----|------|
| pivot_len | 7 | 枢轴点检测窗口 |
| msb_zscore | 0.5 | MSB动量阈值 |
| ob_max_count | 10 | 最大OB追踪数量 |
| hpz_threshold | 80 | 高概率区域阈值 |
| atr_period | 14 | ATR计算周期 |
| atr_multiplier | 1.0 | ATR止损倍数 |
| tp1_multiplier | 0.5 | 第一止盈位 |
| tp2_multiplier | 1.0 | 第二止盈位 |
| tp3_multiplier | 1.5 | 第三止盈位 |

## 回测结果

⚠️ **重要提示**: 该策略在2023-2025年数据上未产生任何交易信号

| 年份 | 交易次数 | 胜率 | 累计收益 | 最大回撤 | 夏普比率 |
|------|---------|------|---------|---------|---------|
| 2023 | 0 | 0.00% | 0.00% | 0.00% | 0.00 |
| 2024 | 0 | 0.00% | 0.00% | 0.00% | 0.00 |
| 2025 | 0 | 0.00% | 0.00% | 0.00% | 0.00 |

### OB统计
- **2023年**: 创建34个OB，失效9个，可靠性26.47%
- **2024年**: 创建41个OB，失效9个，可靠性21.95%
- **2025年**: 创建38个OB，失效10个，可靠性26.32%

## 代码结构

### 主要文件
- `strat_v01_original_pine.py`: 策略主文件
- `strategy/msb_ob_strategy.py`: MSBOBStrategy类

### 主要函数
- `calculate_metrics()`: 计算回测指标（已修正为按交易笔数计算胜率）
- `calculate_ob_stats()`: 计算OB统计信息
- `load_data()`: 加载年份/周期数据
- `run_backtest_for_year()`: 单年回测执行
- `main()`: 主程序入口

### 关键逻辑
1. **MSB检测**: 突破枢轴点且动量Z-Score达标
2. **OB识别**: 在MSB前的强K线作为OB
3. **信号生成**: MSB + OB确认后生成入场信号
4. **风险控制**: ATR动态止损 + 分层止盈

## 优化方向

### 当前问题
1. ⚠️ **无交易信号**: 策略在测试数据上未产生任何交易
2. OB可靠性较低（20-26%）
3. 参数可能不适合当前市场环境

### 改进建议
1. **放宽MSB条件**: 降低msb_zscore阈值（从0.5降至0.3）
2. **简化出场规则**: 移除复杂的OB出场逻辑
3. **调整入场时机**: MSB后延迟入场，等待反向K线
4. **优化参数**: 针对A股市场调整pivot_len、msb_zscore等参数

### 参考版本
建议参考 **V02简化入场** 和 **V03混合策略** 的改进思路

## 适用场景

### 适用市场条件
- 趋势明确的市场
- 波动率适中的环境
- 有明显市场结构的价格走势

### 不适用市场条件
- 震荡盘整市场
- 极低波动率环境
- 缺乏明显价格结构的市场

## 文件位置
- 策略文件: `strategies/v01_original_pine/strat_v01_original_pine.py`
- 回测报告: `strategies/v01_original_pine/report_v01_original_pine.csv`
- 实施计划: `strategies/v01_original_pine/IMPLEMENTATION_PLAN.md`
