# 方案对比测试报告
## 原始方案 vs ATR分层止盈 vs 移动止盈

**测试时间**: 2026-02-18
**测试周期**: 15分钟
**测试年份**: 2023-2025年
**参数**: 原始参数（pivot_len=7, msb_zscore=0.3, atr_period=14, atr_multiplier=1.0）

---

## 方案说明

### 方案1：原始方案（基线）
- **止盈计算**: OB宽度 × 0.5
- **平仓方式**: TP1触发时全部平仓
- **特点**: 快速止盈，但可能过早离场

### 方案2：ATR分层止盈
- **止盈计算**: ATR × 0.5/1.0/1.5（符合Pine原文）
- **平仓方式**: TP1平1/3，TP2平1/3，TP3平1/3
- **特点**: 分批锁定盈利，让盈利交易跑得更远

### 方案3：移动止盈
- **止盈计算**: OB宽度 × 0.5（保留TP1）
- **移动止损**: 盈利1倍ATR后激活，止损跟随最高点/最低点移动
- **移动距离**: 0.5倍ATR
- **特点**: 动态锁定盈利，最大化单笔盈利

---

## 三年汇总对比 (2023-2025)

| 方案 | 三年总收益 | 最大回撤 | 平均夏普 | 总交易数 |
|------|-----------|---------|---------|---------|
| **原始方案** | **24.77%** | 3.04% | **2.01** | 477笔 |
| **ATR分层止盈** | **10.04%** | 3.91% | 0.56 | 695笔 |
| **移动止盈** | **24.68%** | 2.17% | **2.14** | 483笔 |

---

## 年度收益率对比

| 年份 | 原始方案 | ATR分层止盈 | 移动止盈 |
|------|---------|-----------|---------|
| 2023 | 11.26% | 9.59% | 10.13% |
| 2024 | 7.82% | 2.40% | 8.85% |
| 2025 | 5.69% | **-1.96%** | 5.69% |
| **总计** | **24.77%** | 10.04% | **24.68%** |

---

## 关键发现

### 🏆 最佳方案：移动止盈（方案3）

**优势**：
- ✅ 三年总收益率最高（24.68%）
- ✅ 最大回撤最低（2.17%，比原始方案改善28.6%）
- ✅ 夏普比率最高（2.14，比原始方案提升6.5%）
- ✅ 交易次数适中（483笔，介于原始方案和ATR分层之间）

**劣势**：
- 与原始方案收益率基本持平（24.68% vs 24.77%）
- 优势不明显，但更稳健

### ❌ 最差方案：ATR分层止盈（方案2）

**问题**：
- ❌ 三年总收益最差（10.04%）
- ❌ 最大回撤最高（3.91%）
- ❌ 夏普比率最低（0.56）
- ❌ 交易次数最多（695笔，增加46%）

**原因分析**：
1. **ATR倍数止盈目标过远**
   - TP1 = ATR × 0.5 约10-20点
   - OB宽度 × 0.5 只有5-10点
   - ATR止盈目标更难触发，导致持仓时间过长

2. **分层平仓降低了盈利能力**
   - TP1只平1/3仓位，剩余2/3继续持有
   - 但后续TP2/TP3很难触发
   - 大部分仓位最终被止损或震荡平仓

3. **2025年出现亏损**
   - 是唯一在2025年亏损的方案
   - 说明在震荡市中表现更差

---

## 详细分析

### 1. 收益率分析

**原始方案 vs 移动止盈**：
- 收益率基本持平（24.77% vs 24.68%）
- 但移动止盈回撤更小（2.17% vs 3.04%）
- **结论**: 移动止盈更稳健

**ATR分层止盈的表现**：
- 收益率大幅下降（10.04% vs 24.77%）
- 下降59.5%
- **结论**: 不符合当前市场特性

### 2. 交易频率分析

| 方案 | 年均交易 | 相对原始方案 |
|------|---------|-------------|
| 原始方案 | 159笔/年 | 基线 |
| ATR分层止盈 | 232笔/年 | +46% |
| 移动止盈 | 161笔/年 | +1.3% |

**分析**：
- ATR分层止盈交易次数最多，但收益最差
- 移动止盈交易次数基本不变
- **结论**: 交易频率不等于收益

### 3. 2025年表现分析

| 方案 | 2025年收益 | 相对2024年变化 |
|------|-----------|---------------|
| 原始方案 | 5.69% | -27.2% |
| ATR分层止盈 | **-1.96%** | -122.5% |
| 移动止盈 | 5.69% | -35.7% |

**发现**：
- 所有方案在2025年表现都下滑
- ATR分层止盈在2025年直接亏损
- 移动止盈与原始方案持平

---

## 结论与建议

### 🎯 推荐方案

**移动止盈（方案3）**是最佳选择

**理由**：
1. **收益相同但更稳健**
   - 三年收益率与原始方案持平（24.68% vs 24.77%）
   - 最大回撤降低28.6%（3.04% → 2.17%）
   - 夏普比率提升6.5%（2.01 → 2.14）

2. **风险控制更好**
   - 动态锁定盈利
   - 防止盈利回吐
   - 适应市场波动

3. **实现简单**
   - 不需要复杂的分层平仓逻辑
   - 参数容易理解和调整

### ❌ 不推荐

**ATR分层止盈（方案2）不适合当前市场**

**原因**：
1. 与Pine原文的ATR止盈假设不符
2. ATR目标过远，很难触发
3. 分层平仓反而降低了整体收益
4. 在2025年震荡市中表现最差

### 📊 改进建议

**针对移动止盈方案的进一步优化**：

1. **调整移动止损激活距离**
   - 当前：1倍ATR
   - 建议：0.5倍ATR（更早锁定盈利）

2. **调整移动止损距离**
   - 当前：0.5倍ATR
   - 建议：0.3倍ATR（更紧的止损）

3. **添加强制止盈**
   - 移动止损可能长期不平仓
   - 建议添加：盈利3倍ATR强制平仓

---

## 数据文件

- **详细结果**: `comparison_results.csv`
- **策略代码**:
  - `strat_v03_hybrid.py`（原始方案）
  - `strat_v03_atr_partial_exit.py`（ATR分层止盈）
  - `strat_v03_trailing_stop.py`（移动止盈）

---

*报告生成时间: 2026-02-18*
*测试周期: 2023-2025年 15分钟*
*品种: 螺纹钢期货RB9999*
