# V02: 简化入场策略 - 实施计划

## 策略概述
- **版本**: V02
- **名称**: 简化入场策略（Simple Entry Strategy）
- **创建日期**: 2025-02-18
- **目的**: 简化MSB入场规则，提高策略交易频率和稳定性

## 实现目标
1. 简化MSB入场规则：MSB信号后，下一根反向K线入场
2. 固定持仓时间：3根K线后强制平仓
3. 提高交易频率和策略稳定性
4. 作为V01和V03之间的基准策略

## 入场规则

### MSB信号检测
1. **看涨MSB**:
   - 价格突破最近的高点枢轴点（pivot_high）
   - 前一根K线收盘价 ≤ 枢轴点
   - 当前根K线收盘价 > 枢轴点
   - 动量Z-Score > 0.3

2. **看跌MSB**:
   - 价格突破最近的低点枢轴点（pivot_low）
   - 前一根K线收盘价 ≥ 枢轴点
   - 当前根K线收盘价 < 枢轴点
   - 动量Z-Score < -0.3

### 入场时机（简化）
- **做多**: MSB看涨信号后，下一根K线如果是阴线（收盘<开盘），则开多
- **做空**: MSB看跌信号后，下一根K线如果是阳线（收盘>开盘），则开空

**逻辑**: MSB突破后，等待反向K线入场，寻求更好的入场价格

## 出场规则

### 固定时间出场
- 持仓满3根K线后，强制平仓
- 不考虑盈亏，严格执行时间出场

### 无止损止盈
- 不设置止损位
- 不设置止盈位
- 完全依赖时间出场

## 风险管理
- **时间止损**: 固定3根K线持仓
- **仓位管理**: 等权重分配
- **风险暴露**: 每笔交易风险由市场波动决定

## 回测参数
- **数据周期**: 60分钟、15分钟、5分钟
- **回测期间**: 2023-2025年
- **交易品种**: RB9999（螺纹钢主力合约）

### 关键参数
| 参数 | 值 | 说明 |
|------|-----|------|
| pivot_len | 7 | 枢轴点检测窗口 |
| msb_zscore | 0.3 | MSB动量阈值（降低以提高频率） |
| holding_bars | 3 | 固定持仓K线数 |

## 回测结果

### 60分钟周期
| 年份 | 交易数 | 胜率 | 累计收益 | 最大回撤 | 夏普比率 |
|------|-------|------|---------|---------|---------|
| 2023 | 28 | 64.29% | +0.07% | -0.02% | - |
| 2024 | 17 | 52.94% | -0.01% | -0.02% | - |
| 2025 | 31 | 70.97% | +0.05% | -0.01% | - |
| **合计** | **76** | **62.73%** | **+0.12%** | **-0.02%** | **0.90** |

### 15分钟周期
| 年份 | 交易数 | 胜率 | 累计收益 | 最大回撤 | 夏普比率 |
|------|-------|------|---------|---------|---------|
| 2023 | 82 | 67.07% | +0.12% | -0.01% | - |
| 2024 | 76 | 63.16% | +0.06% | -0.03% | - |
| 2025 | 70 | 61.43% | +0.05% | -0.01% | - |
| **合计** | **228** | **63.89%** | **+0.23%** | **-0.03%** | **1.89** |

### 5分钟周期
| 年份 | 交易数 | 胜率 | 累计收益 | 最大回撤 | 夏普比率 |
|------|-------|------|---------|---------|---------|
| 2023 | 220 | 64.55% | +0.18% | -0.01% | - |
| 2024 | 190 | 59.47% | +0.12% | -0.03% | - |
| 2025 | 193 | 60.10% | +0.10% | -0.02% | - |
| **合计** | **603** | **61.37%** | **+0.41%** | **-0.03%** | **3.23** |

### 综合对比

| 周期 | 交易数 | 胜率 | 累计收益 | 最大回撤 | 夏普比率 |
|------|-------|------|---------|---------|---------|
| 60min | 76 | 62.73% | +0.12% | -0.02% | 0.90 |
| 15min | 228 | 63.89% | +0.23% | -0.03% | 1.89 |
| 5min | 603 | 61.37% | +0.41% | -0.03% | 3.23 |

**关键发现**:
- 胜率稳定在60-64%
- 短周期交易频率更高，收益更好
- 夏普比率随周期缩短显著提升

## 代码结构

### 主要文件
- `strat_v02_simple_entry.py`: 策略主文件

### 主要函数
- `calculate_momentum_z()`: 计算动量Z-Score
- `detect_pivots()`: 检测枢轴点
- `simple_msb_ob_strategy()`: 简化版策略逻辑
- `calculate_metrics()`: 计算回测指标（已修正为按交易笔数）
- `load_data()`: 加载年份/周期数据
- `main()`: 主程序入口

### 关键逻辑流程
```python
1. 计算动量Z-Score
2. 检测枢轴点（pivot_high/pivot_low）
3. 检测MSB信号（突破枢轴点 + 动量条件）
4. 生成入场信号：
   - 如果MSB看涨 → 等待阴线开多
   - 如果MSB看跌 → 等待阳线开空
5. 固定持仓3根K线后平仓
```

## 优化方向

### 当前优点
1. ✅ 逻辑简单，易于理解和实施
2. ✅ 交易频率适中（每年60-600笔，取决于周期）
3. ✅ 胜率稳定（60-64%）
4. ✅ 短周期表现优异（夏普比率>3）

### 当前缺点
1. ❌ 每笔平均收益较小（约0.0007-0.0002）
2. ❌ 缺乏止损机制，可能遭遇大额亏损
3. ❌ 固定时间出场可能错失更大盈利
4. ❌ 累计收益较低（3年仅0.12-0.41%）

### 改进建议

#### 高优先级
1. **添加止损机制**: 使用ATR动态止损，控制单笔最大亏损
2. **优化持仓时间**: 根据市场波动调整持仓K线数
3. **分层止盈**: 参考V03的TP1/TP2/TP3逻辑

#### 中优先级
4. **入场优化**: 可以考虑等待更深的回调入场
5. **出场优化**: 结合市场状态决定出场时机
6. **仓位管理**: 根据信号强度调整仓位大小

#### 低优先级
7. **参数优化**: 测试不同的pivot_len和msb_zscore组合
8. **多周期确认**: 结合高周期MSB信号提高准确率

## 适用场景

### 最佳适用
- 快速交易环境
- 需要稳定胜率的场景
- 自动化交易系统
- 作为复杂策略的基础模块

### 风险提示
- 固定时间出场可能在小趋势中过早离场
- 缺乏止损可能导致极端行情下大额亏损
- 单笔收益较小，需要高杠杆或大仓位才能获得显著收益

## 版本对比

| 特性 | V01原版 | V02简化 | V03混合 |
|------|---------|---------|---------|
| 入场规则 | MSB即时入场 | MSB+反向K线 | MSB+反向K线 |
| 出场规则 | OB+ATR分层 | 固定3根K线 | ATR分层 |
| 止损 | 有（1倍ATR） | 无 | 有（1倍ATR） |
| 交易频率 | 极低（0笔） | 中等 | 中等 |
| 胜率（60min） | N/A | 62.73% | 83.07% |
| 夏普（60min） | N/A | 0.90 | 1.17 |
| 复杂度 | 高 | 低 | 中 |

## 实施建议

### 实盘部署前
1. ✅ 在历史数据上验证策略稳定性
2. ✅ 在模拟账户中测试至少3个月
3. ✅ 准备风险控制预案

### 实盘部署
1. 从小仓位开始，逐步放大
2. 严格记录每笔交易，便于后续分析
3. 定期检查策略参数是否需要调整

### 监控指标
- 每日交易次数
- 胜率变化趋势
- 最大连续亏损次数
- 平均持仓时间

## 文件位置
- 策略文件: `strategies/v02_simple_entry/strat_v02_simple_entry.py`
- 回测报告: `strategies/v02_simple_entry/report_v02_simple_entry.csv`
- 实施计划: `strategies/v02_simple_entry/IMPLEMENTATION_PLAN.md`
